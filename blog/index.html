<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Blog</title>
    <meta name="description" content="">
    <meta name="author" content="Daniel Schep">

    <!--  Mobile viewport optimized: j.mp/bplateviewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.2.0/superhero/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="../static/site.css">
    

    
    
    




  </head>

  <body>

    
    <nav class="navbar navbar-top navbar-inverse" role="navigation">
    <nav role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="/">Daniel Schep</a>
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div id="navbar" class="collapse navbar-collapse navbar-right">
          <ul class="nav navbar-nav">
            
              <li class="">
                  <a href="/">Home</a>
              </li>
            
              <li class="">
                  <a href="/work">Work</a>
              </li>
            
              <li class="">
                  <a href="/blog">Blog</a>
              </li>
            
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    </nav>
    

    
    <div class="container">
    
  
    
  <div class="blog-post">
  
    <h2><a href="../blog/working-with-mutually-exclusive-formfields-in-django/">Working with Mutually Exclusive Fields in Django Forms</a></h2>
  
  <p class="meta">
    written by
    
      <a href="https://twitter.com/schep_">Daniel Schep</a>
    
    on 2014-10-08
  </p>
  <p><style>
iframe {
    background: white;
    border: none;
    width: 100%;
}
</style>
Republished from the <a href="http://blog.celerity.com/working-mutually-exclusive-fields-django-forms" target="_blank">Celerity blog</a>.</p>
<p>Attention Django developers! When soliciting input from users with an HTML
form, you want to design forms to be as flexible as possible. That means you
build in multiple form fields to support multiple input options, even if you
only want the user to fill in one of them.</p>
<p>Having two or more mutually exclusive fields in a form on a webpage/webapp is a
pretty frequent scenario developers have to deal with. Unfortunately, Django's
forms have no builtin support for this. In this blog post, I will cover the two
simple, but ugly, solutions we Django developers often find ourselves using and
introduce a library that makes working with such scenarios much simpler.</p>
<h2>v1: Helptext &amp; Validation</h2>
<p>The most important part of working with mutually exclusive fields is ensuring
that only one of the fields is filled in. This can be achieved by a simple
check in the form's <code>clean</code> method. The following code snipped demonstrates
that check.</p>
<pre><code>def clean(self):
    cleaned_data = super(TestForm, self).clean()

    if not (bool(self.cleaned_data['test_field1']) !=
            bool(self.cleaned_data['test_field2'])):
        raise forms.ValidationError, 'Fill in only one of the two fields'

    return cleaned_data
</code></pre>
<p>And here it is in action:</p>
<p><iframe src="http://djmutuallyexclusivefieldsdemo.herokuapp.com/v1" style="height: 170px;"></iframe>
<br></p>
<h2>v2: Add Some JavaScript!</h2>
<p>As you can see, the main issue with the barebones approach is that the user
experience is pretty awful and relies on help text to explain the situation to
the user.</p>
<p>A way to simplify the user experience is to add radio buttons infront of the
two fields and only allow one field to be enabled at a time. Here is a simple
implementation of that using jQuery.</p>
<pre><code>$(document).ready(function() {
    $('#id_test_field1,#id_test_field2').each(function(i, e) {
        $('&lt;input name="test_field" type="radio" value="'+i+'"&gt;')
            .insertBefore(e)
            .click(function() {
                $('#id_test_field1,#id_test_field2').attr('disabled', 'disabled');
                $(e).removeAttr('disabled');
            })
            .next('#id_test_field1').prev().click();
    });
});
</code></pre>
<p>And here it is in action:</p>
<p><iframe src="http://djmutuallyexclusivefieldsdemo.herokuapp.com/v2" style="height: 150px;"></iframe>
<br></p>
<h2>v3: django-xor-formfields</h2>
<p>The third approach involved developing a custom field &amp; widget that renders as
two widgets in the DOM and has the requisite JavaScript to manage the disabling
of unused fields.</p>
<p>The library I developed is available on
<a href="https://github.com/dschep/django-xor-formfields"
   target="_blank">Github</a> and <a target="_blank"
   href="https://pypi.python.org/pypi/django-xor-formfields">PyPI</a>.</p>
<p>It consists of two main parts, the <code>MutuallyExclusiveRadioWidget</code> and the
<code>MutuallyExclusiveValueField</code>.</p>
<p>The <code>MutuallyExclusiveRadioWidget</code> accepts
a list of django widgets and renders them with a radio button in front of each
widget. The widgets are all rendered with the same <code>name</code> parameter in the DOM
because since all but one of them is disabled by the JavaScript, only one value
gets POSTed to the server.</p>
<p>The <code>MutuallyExclusiveValueField</code> must be passed an iterable of fields and a
<code>MutuallyExclusiveRadioWidget</code> built with the respective widgets for those
fields. The field validates that only one of the subfields is populated and
that is the value of the field.</p>
<p>An example of using this field/widget combo looks like this:</p>
<pre><code>test_field = MutuallyExclusiveValueField(
        fields=(forms.IntegerField(), forms.IntegerField()),
        widget=MutuallyExclusiveRadioWidget(widgets=(
            forms.Select(choices=[(1,1), (2,2), (3,3)]),
            forms.TextInput(),
        )))
</code></pre>
<p>And here it is in action:</p>
<p><iframe src="http://djmutuallyexclusivefieldsdemo.herokuapp.com/v3" style="height: 120px;"></iframe>
<br></p>
<h2>Bonus! Files &amp; URL Normalizaion</h2>
<p>The main usecase that prompted developing the django-xor-formfields package was
to allow users to upload files by either submitting an URL or a file. So I
created the <code>FileOrURLField</code>. It is a subclass of <code>MutuallyExclusiveValueField</code>
and automatically uses <code>FileOrURLWidget</code>, a subclass of
<code>MutuallyExclusiveRadioWidget</code>.</p>
<p>It supports 3 forms of normalization through the <code>to</code> kwarg:</p>
<ul>
<li><code>None</code> (passthrough)</li>
<li><code>'url'</code></li>
<li><code>'file'</code></li>
</ul>
<p>The later two options allow the code using your form to be completely unaware
of how the user submitted their file or URL. If 'url' is specified and the user
uploads a file, the field with download the file and store it as media and
return the URL for that file. If 'file' is specified and the user submits an
URL, the field will download that file into an <code>InMemoryUploadedFile</code>.An
example of using this field which normalized to files is:</p>
<p>And here it is in action:</p>
<p><iframe src="http://djmutuallyexclusivefieldsdemo.herokuapp.com/v4" style="height: 300px" ></iframe>
<br></p>
<h2>Notes</h2>
<p>The code for the demos is available on
<a href="https://github.com/dschep/django_mutuallyexclusive_formfields_blogpost"
   target="_blank">Github</a>.</p>

  </div>

  
    
  <div class="blog-post">
  
    <h2><a href="../blog/bechdel-test-pass-rates/">Bechdel Test Pass Rates</a></h2>
  
  <p class="meta">
    written by
    
      <a href="https://twitter.com/schep_">Daniel Schep</a>
    
    on 2013-03-08
  </p>
  <p>Made with data from 
<a href="http://bechdeltest.com/" target="_blank">bechdeltest.com</a>.
Sources in
<a href="http://gist.github.com/dschep/5121543" target="_blank">Gist 5121543</a></p>
<p>The data is very sparse before 1930ish, leading to some 100% pass rates</p>
<div id='bechdel-chart'></div><p><style>#bechdel-chart {
  overflow-x: auto;
} #bechdel-chart svg {
  background: white;
}
.chart rect {
    stroke: white;
    fill: steelblue;
}
.chart text {
    font: 10px sans-serif;
}
</style></p>
<script src="http://d3js.org/d3.v3.min.js"></script><script>
var h = 500 - 40,
    w = 760 - 40;

var y = d3.scale.linear()
    .domain([0, 1])
    .range([0, h-20]);

var x = d3.scale.linear()
    .domain([1900, 2013])
    .range([0, w]);

var chart = d3.select("#bechdel-chart").append("svg")
    .attr("class", "chart")
    .attr("height", h + 40)
    .attr("width", w + 40)
  .append('g')
    .attr('transform', 'translate(20, 20)');


chart.selectAll('.tickline')
    .data(y.ticks(10))
  .enter().append('line')
    .attr('class', 'tickline')
    .attr('x1', 0)
    .attr('x2', w)
    .attr('y1', function(d) { return h  - y(d); })
    .attr('y2', function(d) { return h  - y(d); })
    .style("stroke-width", 1)
    .style("stroke", "#ccc");



chart.selectAll('.percent')
    .data(y.ticks(10))
  .enter().append('text')
    .attr('class', 'percent')
    .attr('x', 20)
    .attr('y', function(d) { return h  - y(d); })
    .text(String);



d3.json('/blog/bechdel-test-pass-rates/bechdel-passing.json', function(error, data){

    chart.selectAll("rect")
        .data(data)
      .enter().append("rect")
          .attr("x", function(d) { return x(d.year); })
          .attr('y', function(d) { return h - y(d.value); })
          .attr('height', function(d) { return y(d.value); })
          .attr("width", '4');

    chart.append('line')
        .attr('x1', 0)
        .attr('x2', w)
        .attr('y1', h)
        .attr('y2', h)
        .style("stroke-width", 2)
        .style("stroke", "#000");

    chart.selectAll('.rule')
        .data(x.ticks(10))
      .enter().append('text')
        .attr('class', 'rule')
        .attr('x', x)
        .attr('y', h)
        .attr('dy', 20)
        .attr('text-anchor', 'middle')
        .text(String)

})


</script>
  </div>

  
    
  <div class="blog-post">
  
    <h2><a href="../blog/hardening-synology-dsm-ssl/">Hardening Synology DSM SSL</a></h2>
  
  <p class="meta">
    written by
    
      <a href="https://twitter.com/schep_">Daniel Schep</a>
    
    on 2013-02-05
  </p>
  <p>Synology DSM 4.1 is vulnerable to 
<a href="https://community.qualys.com/blogs/securitylabs/2011/10/17/mitigating-the-beast-attack-on-tls" target="_blank">BEAST</a>
and the
<a href="http://www.isg.rhul.ac.uk/tls/" target="_blank">Lucky Thirteen</a>
 attacks out of the box. Switching to RC4 ciphers makes these attacks, and any other future CBC-targeting attacks, not work.
To fix this these 2 files need to be updated:</p>
<pre><code>/usr/syno/apache/conf/extra/httpd-alt-port-ssl-setting.conf
/usr/syno/apache/conf/extra/httpd-ssl.conf-common
</code></pre>
<p>Update them such that the line starting with <code>SSLCipherSuite</code> is replaced with these two lines:</p>
<pre><code>SSLHonorCipherOrder On
SSLCipherSuite RC4-SHA:HIGH:!ADH:!SSLv2
</code></pre>
<p>Restart Apache:</p>
<pre><code>/usr/syno/etc/rc.d/S97apache-sys.sh restart
/usr/syno/etc/rc.d/S97apache-user.sh restart
</code></pre>
<p>Double check that no other Apache configs contain SSLCipherSuite options:</p>
<pre><code>grep SSLCipher /usr/syno/apache/conf/extra/*
</code></pre>
<h3>Sources</h3>
<ul>
<li><a href="http://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/"
   target="_blank">http://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/</a></li>
<li><a href="http://forum.synology.com/enu/viewtopic.php?f=19&t=41794&p=166563&hilit=BEAST+SSL#p166563"
target="_blank">http://forum.synology.com/enu/viewtopic.php?f=19&t=41794&p=166563&hilit=BEAST+SSL#p166563</a></li>
</ul>

  </div>

  
    
  <div class="blog-post">
  
    <h2><a href="../blog/tomato-namecheap-vulnerability/">Tomato &amp; Namecheap Vulnerability</a></h2>
  
  <p class="meta">
    written by
    
      <a href="https://twitter.com/schep_">Daniel Schep</a>
    
    on 2012-12-04
  </p>
  <p>I discovered today that
<a href="http://www.polarcloud.com/tomato" target="_blank">Tomato</a>'s
<a href="http://www.namecheap.com/" target="_blank">Namecheap</a>
Dynamic DNS updater support use HTTP with passwords in the GET parameters.</p>
<p>This means your passwords are super easy to sniff on the wire.  Don't use it.</p>
<p>Namecheap shouldn't be accepting this sort of request with out HTTPS and Tomato
shouldn't be using it.</p>
<p>Here's how I found it:
<img src="/blog/tomato-namecheap-vulnerability/namecheap-ddns.png" class="img-responsive"></p>
<p>Password has obviously already been regenerated.</p>
<h3>Simple alternative</h3>
<p>Curl on any linux box will serve the purpose nicely (note the https://):</p>
<pre><code>curl "https://dynamicdns.park-your-domain.com/update?host=$HOST&amp;domain=$DOMAIN&amp;password=$PASSWORD&amp;ip=`curl -s http://my-ip.heroku.com/`"
</code></pre>

  </div>

  
    
  <div class="blog-post">
  
    <h2><a href="../blog/gmvault-on-synology/">Gmvault on Synology NAS</a></h2>
  
  <p class="meta">
    written by
    
      <a href="https://twitter.com/schep_">Daniel Schep</a>
    
    on 2012-11-18
  </p>
  <ol>
<li>Install Python from DSM Package Center</li>
<li>Enable SSH</li>
<li>SSH in</li>
<li>Enable and switch to user shell (optional, requres user homes to be enabled)<ul>
<li>set shell to <code>/bin/ash</code> in <code>/etc/passwd</code></li>
<li><code>su - &lt;user&gt;</code></li>
</ul>
</li>
<li>Create directory to store all of this (optional)<ul>
<li><code>mkdir gmvault&amp;&amp;cd gmvault</code></li>
</ul>
</li>
<li>Get virtualenv<ul>
<li><code>wget https://raw.github.com/pypa/virtualenv/develop/virtualenv.py</code></li>
</ul>
</li>
<li>Create virtualenv &amp; install gmvault<ul>
<li><code>python virtualenv.py venv</code></li>
<li><code>./venv/bin/pip install gmvault</code></li>
</ul>
</li>
<li>Backup Gmail!<ul>
<li><code>ash ./venv/bin/gmvault sync username@gmail.com</code></li>
</ul>
</li>
</ol>
<h3>Relevant Links:</h3>
<ul>
<li><a href="http://gmvault.org/">http://gmvault.org/</a></li>
<li><a href="https://github.com/pypa/virtualenv">https://github.com/pypa/virtualenv</a></li>
</ul>

  </div>

  

  
  <div class="pagination">
    
      <span class="disabled">&laquo; Previous</span>
    
    | 1 |
    
      <span class="disabled">Next &raquo;</span>
    
  </div>


    </div>
    

    <div class="footer hidden-print">
      <div class="container">
        <p class="pull-left ">
          <i class="fa fa-copyright"></i> Daniel Schep
        </p>
        <ul class="pull-right">
          <li><a href="mailto:dschep@gmail.com">
            <i class="fa fa-envelope"></i><span class="network-label"> dschep@gmail.com</span>
          </a></li>
          <li><a href="https://github.com/dschep" target="_blank">
            <i class="fa fa-github"></i><span class="network-label"> dschep</span>
          </a></li>
          <li><a href="https://keybase.io/dschep" target="_blank">
            <i class="fa fa-key"></i><span class="network-label"> dschep</span>
          </a></li>
          <li><a href="https://twitter.com/schep_" target="_blank">
            <i class="fa fa-twitter"></i><span class="network-label"> schep_</span>
          </a></li>
          <li><a href="https://www.linkedin.com/in/daniel-schep-b1400870" target="_blank">
            <i class="fa fa-linkedin"></i><span class="network-label"> Daniel Schep</span>
          </a></li>
        </ul>
      </div>
    </div>


    
      
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
      
      <script src="https://cdn.jsdelivr.net/bootstrap/3.3.0/js/bootstrap.min.js"></script>

      
      
    

    <!-- asynchronous google analytics: mathiasbynens.be/notes/async-analytics-snippet
       change the UA-XXXXX-X to be your site's ID -->
<script>
    var _gaq = [['_setAccount', 'UA-40822116-2'], ['_trackPageview']];
    (function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = ('https:' == location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
    })(document, 'script');
</script>
  </body>
</html>

