<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Working with Mutually Exclusive Fields in Django Forms</title>
    <meta name="description" content="">
    <meta name="author" content="Daniel Schep">

    <!--  Mobile viewport optimized: j.mp/bplateviewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.2.0/superhero/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="../../static/site.css">
    

    
    
    




  </head>

  <body>

    
    <nav class="navbar navbar-top navbar-inverse" role="navigation">
    <nav role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="/">Daniel Schep</a>
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div id="navbar" class="collapse navbar-collapse navbar-right">
          <ul class="nav navbar-nav">
            
              <li class="">
                  <a href="/">Home</a>
              </li>
            
              <li class="">
                  <a href="/work">Work</a>
              </li>
            
              <li class="">
                  <a href="https://social.schep.me">Microblog</a>
              </li>
            
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    </nav>
    

    
    <div class="container">
    
  
  <div class="blog-post">
  
    <h2>Working with Mutually Exclusive Fields in Django Forms</h2>
  
  <p class="meta">
    written by
    
      <a href="https://twitter.com/schep_">Daniel Schep</a>
    
    on 2014-10-08
  </p>
  <p><style>
iframe {
    background: white;
    border: none;
    width: 100%;
}
</style>
Republished from the <a href="http://blog.celerity.com/working-mutually-exclusive-fields-django-forms" target="_blank">Celerity blog</a>.</p>
<p>Attention Django developers! When soliciting input from users with an HTML
form, you want to design forms to be as flexible as possible. That means you
build in multiple form fields to support multiple input options, even if you
only want the user to fill in one of them.</p>
<p>Having two or more mutually exclusive fields in a form on a webpage/webapp is a
pretty frequent scenario developers have to deal with. Unfortunately, Django's
forms have no builtin support for this. In this blog post, I will cover the two
simple, but ugly, solutions we Django developers often find ourselves using and
introduce a library that makes working with such scenarios much simpler.</p>
<h2>v1: Helptext &amp; Validation</h2>
<p>The most important part of working with mutually exclusive fields is ensuring
that only one of the fields is filled in. This can be achieved by a simple
check in the form's <code>clean</code> method. The following code snipped demonstrates
that check.</p>
<pre><code>def clean(self):
    cleaned_data = super(TestForm, self).clean()

    if not (bool(self.cleaned_data['test_field1']) !=
            bool(self.cleaned_data['test_field2'])):
        raise forms.ValidationError, 'Fill in only one of the two fields'

    return cleaned_data
</code></pre>
<p>And here it is in action:</p>
<p><iframe src="http://djmutuallyexclusivefieldsdemo.herokuapp.com/v1" style="height: 170px;"></iframe>
<br></p>
<h2>v2: Add Some JavaScript!</h2>
<p>As you can see, the main issue with the barebones approach is that the user
experience is pretty awful and relies on help text to explain the situation to
the user.</p>
<p>A way to simplify the user experience is to add radio buttons infront of the
two fields and only allow one field to be enabled at a time. Here is a simple
implementation of that using jQuery.</p>
<pre><code>$(document).ready(function() {
    $('#id_test_field1,#id_test_field2').each(function(i, e) {
        $('&lt;input name="test_field" type="radio" value="'+i+'"&gt;')
            .insertBefore(e)
            .click(function() {
                $('#id_test_field1,#id_test_field2').attr('disabled', 'disabled');
                $(e).removeAttr('disabled');
            })
            .next('#id_test_field1').prev().click();
    });
});
</code></pre>
<p>And here it is in action:</p>
<p><iframe src="http://djmutuallyexclusivefieldsdemo.herokuapp.com/v2" style="height: 150px;"></iframe>
<br></p>
<h2>v3: django-xor-formfields</h2>
<p>The third approach involved developing a custom field &amp; widget that renders as
two widgets in the DOM and has the requisite JavaScript to manage the disabling
of unused fields.</p>
<p>The library I developed is available on
<a href="https://github.com/dschep/django-xor-formfields"
   target="_blank">Github</a> and <a target="_blank"
   href="https://pypi.python.org/pypi/django-xor-formfields">PyPI</a>.</p>
<p>It consists of two main parts, the <code>MutuallyExclusiveRadioWidget</code> and the
<code>MutuallyExclusiveValueField</code>.</p>
<p>The <code>MutuallyExclusiveRadioWidget</code> accepts
a list of django widgets and renders them with a radio button in front of each
widget. The widgets are all rendered with the same <code>name</code> parameter in the DOM
because since all but one of them is disabled by the JavaScript, only one value
gets POSTed to the server.</p>
<p>The <code>MutuallyExclusiveValueField</code> must be passed an iterable of fields and a
<code>MutuallyExclusiveRadioWidget</code> built with the respective widgets for those
fields. The field validates that only one of the subfields is populated and
that is the value of the field.</p>
<p>An example of using this field/widget combo looks like this:</p>
<pre><code>test_field = MutuallyExclusiveValueField(
        fields=(forms.IntegerField(), forms.IntegerField()),
        widget=MutuallyExclusiveRadioWidget(widgets=(
            forms.Select(choices=[(1,1), (2,2), (3,3)]),
            forms.TextInput(),
        )))
</code></pre>
<p>And here it is in action:</p>
<p><iframe src="http://djmutuallyexclusivefieldsdemo.herokuapp.com/v3" style="height: 120px;"></iframe>
<br></p>
<h2>Bonus! Files &amp; URL Normalizaion</h2>
<p>The main usecase that prompted developing the django-xor-formfields package was
to allow users to upload files by either submitting an URL or a file. So I
created the <code>FileOrURLField</code>. It is a subclass of <code>MutuallyExclusiveValueField</code>
and automatically uses <code>FileOrURLWidget</code>, a subclass of
<code>MutuallyExclusiveRadioWidget</code>.</p>
<p>It supports 3 forms of normalization through the <code>to</code> kwarg:</p>
<ul>
<li><code>None</code> (passthrough)</li>
<li><code>'url'</code></li>
<li><code>'file'</code></li>
</ul>
<p>The later two options allow the code using your form to be completely unaware
of how the user submitted their file or URL. If 'url' is specified and the user
uploads a file, the field with download the file and store it as media and
return the URL for that file. If 'file' is specified and the user submits an
URL, the field will download that file into an <code>InMemoryUploadedFile</code>.An
example of using this field which normalized to files is:</p>
<p>And here it is in action:</p>
<p><iframe src="http://djmutuallyexclusivefieldsdemo.herokuapp.com/v4" style="height: 300px" ></iframe>
<br></p>
<h2>Notes</h2>
<p>The code for the demos is available on
<a href="https://github.com/dschep/django_mutuallyexclusive_formfields_blogpost"
   target="_blank">Github</a>.</p>

  </div>


    </div>
    

    <div class="footer hidden-print">
      <div class="container">
        <p class="pull-left ">
          <i class="fa fa-copyright"></i> Daniel Schep
        </p>
        <ul class="pull-right">
          <li><a href="mailto:dschep@gmail.com">
            <i class="fa fa-envelope"></i><span class="network-label"> dschep@gmail.com</span>
          </a></li>
          <li><a href="https://github.com/dschep" target="_blank" rel="me">
            <i class="fa fa-github"></i><span class="network-label"> dschep</span>
          </a></li>
          <li><a href="https://keybase.io/dschep" target="_blank">
            <i class="fa fa-key"></i><span class="network-label"> dschep</span>
          </a></li>
          <li><a href="https://mastodon.social/@dschep" rel="me" target="_blank">
            <i class="fa fa-twitter"></i><span class="network-label"> @dschep@mastodon.social</span>
          </a></li>
          <li><a href="https://www.linkedin.com/in/daniel-schep-b1400870" target="_blank">
            <i class="fa fa-linkedin"></i><span class="network-label"> Daniel Schep</span>
          </a></li>
        </ul>
      </div>
    </div>


    
      
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
      
      <script src="https://cdn.jsdelivr.net/bootstrap/3.3.0/js/bootstrap.min.js"></script>

      
      
    

    <!-- 100% privacy friendly analytics -->
    <script data-collect-dnt="true" async defer src="https://sa.trailsta.sh/latest.js"></script>
    <noscript><img src="https://sa.trailsta.sh/noscript.gif?collect-dnt=true" alt="" referrerpolicy="no-referrer-when-downgrade" /></noscript>
  </body>
</html>

